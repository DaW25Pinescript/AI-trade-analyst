{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://ai-trade-analyst.local/schema/ticket.schema.json",
  "title": "AI Trade Analyst Ticket",
  "description": "Canonical trade ticket payload for export/import and persistence.",
  "type": "object",
  "additionalProperties": false,
  "required": [
    "schemaVersion",
    "ticketId",
    "createdAt",
    "decisionMode",
    "ticketType",
    "entryType",
    "entryTrigger",
    "confirmationTF",
    "timeInForce",
    "maxAttempts",
    "entry",
    "stop",
    "targets",
    "checklist",
    "gate"
  ],
  "properties": {
    "schemaVersion": {
      "type": "string",
      "const": "1.0.0"
    },
    "ticketId": { "type": "string", "minLength": 1 },
    "createdAt": { "type": "string", "format": "date-time" },
    "decisionMode": {
      "type": "string",
      "enum": ["LONG", "SHORT", "WAIT", "CONDITIONAL"]
    },
    "ticketType": {
      "type": "string",
      "enum": ["Zone ticket", "Exact ticket"]
    },
    "entryType": {
      "type": "string",
      "enum": ["Market", "Limit", "Stop"]
    },
    "entryTrigger": {
      "type": "string",
      "enum": [
        "Pullback to zone",
        "Break + retest",
        "Sweep + reclaim",
        "Close above/below level",
        "Momentum shift (MSS/BOS)"
      ]
    },
    "confirmationTF": {
      "type": "string",
      "enum": ["1m", "5m", "15m", "1H"]
    },
    "timeInForce": {
      "type": "string",
      "enum": ["This session", "Next 1H", "24H", "Custom"]
    },
    "maxAttempts": {
      "type": "integer",
      "minimum": 1,
      "maximum": 3
    },
    "entry": {
      "type": "object",
      "additionalProperties": false,
      "required": ["zone", "priceMin", "priceMax", "notes"],
      "properties": {
        "zone": { "type": "string", "minLength": 1 },
        "priceMin": { "type": "number" },
        "priceMax": { "type": "number" },
        "notes": { "type": "string" }
      }
    },
    "stop": {
      "type": "object",
      "additionalProperties": false,
      "required": ["price", "logic", "rationale"],
      "properties": {
        "price": { "type": "number" },
        "logic": {
          "type": "string",
          "enum": [
            "Below swing low / above swing high",
            "Below zone",
            "ATR-based",
            "Structure-based + buffer"
          ]
        },
        "rationale": { "type": "string", "minLength": 1 }
      }
    },
    "targets": {
      "type": "array",
      "minItems": 1,
      "items": {
        "type": "object",
        "additionalProperties": false,
        "required": ["label", "price", "rationale"],
        "properties": {
          "label": { "type": "string", "enum": ["TP1", "TP2", "TP3"] },
          "price": { "type": "number" },
          "rationale": { "type": "string", "minLength": 1 }
        }
      }
    },
    "checklist": {
      "type": "object",
      "additionalProperties": false,
      "required": [
        "htfState",
        "htfLocation",
        "ltfAlignment",
        "liquidityContext",
        "volRisk",
        "execQuality",
        "conviction",
        "edgeTag",
        "confluenceScore"
      ],
      "properties": {
        "htfState": { "type": "string", "enum": ["Trending", "Ranging", "Transition"] },
        "htfLocation": { "type": "string", "enum": ["At POI", "Mid-range", "At extremes"] },
        "ltfAlignment": { "type": "string", "enum": ["Aligned", "Counter-trend", "Mixed"] },
        "liquidityContext": { "type": "string", "enum": ["Near obvious highs/lows", "Equilibrium", "None identified"] },
        "volRisk": { "type": "string", "enum": ["Normal", "Elevated"] },
        "execQuality": { "type": "string", "enum": ["Clean", "Messy", "Chop"] },
        "conviction": { "type": "string", "enum": ["Very High", "High", "Medium", "Low"] },
        "edgeTag": {
          "type": "string",
          "enum": ["High-probability pullback", "Liquidity grab", "FVG reclaim", "Structure BOS", "Range boundary", "Other"]
        },
        "confluenceScore": { "type": "integer", "minimum": 1, "maximum": 10 }
      }
    },
    "gate": {
      "type": "object",
      "additionalProperties": false,
      "required": ["status", "waitReasonCode", "reentryCondition", "reentryTime"],
      "properties": {
        "status": { "type": "string", "enum": ["INCOMPLETE", "PROCEED", "CAUTION", "WAIT"] },
        "waitReasonCode": {
          "type": "string",
          "enum": ["", "Chop / range noise", "HTF-LTF conflict", "No POI / poor R:R", "News risk / volatility", "Already moved / late trend"]
        },
        "reentryCondition": { "type": "string" },
        "reentryTime": { "type": "string" }
      }
    }
  }
}
